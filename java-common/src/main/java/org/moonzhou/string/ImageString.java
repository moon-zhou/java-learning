package org.moonzhou.string;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Base64;
import java.util.List;

/**
 * @author moon zhou
 * @version 1.0
 * @description: image string check
 * @date 2024/7/1 13:36
 */
public class ImageString {
    /**
     * 1024 * 1024 * 10 MB
     */
    private static final Long MAX_FILE_SIZE = 10485760L;

    /**
     * 允许的图片类型
     */
    private static final List<String> FILE_TYPE_LIST = new ArrayList<>(Arrays.asList("JPEG", "PNG", "GIF", "WebP", "TIFF", "BMP", "SVG", "HEIC"));

    /**
     * data:image/jpg;base64,iVBORw0KGgoAAAANSUhEUg....
     */
    private static final String IMAGE_BASE_64 = "data:image/png;base64,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";

    public static void main(String[] args) {
        checkImg();
    }

    /**
     * check img: file size and file type
     * file size less than 10MB
     * file type is mobile image
     */
    public static void checkImg() {
        // 文件大小
        byte[] imageBytes = Base64.getDecoder().decode(IMAGE_BASE_64.substring(IMAGE_BASE_64.indexOf(',') + 1));
        System.out.println(imageBytes.length);
        if (imageBytes.length > MAX_FILE_SIZE) {
            throw new IllegalArgumentException("File size exceeds the limit of 10MB");
        }

        // 文件类型
        String format = IMAGE_BASE_64.substring("data:image/".length(), IMAGE_BASE_64.indexOf(';'));
        boolean formatCheckResult = FILE_TYPE_LIST.stream()
                .anyMatch(type -> type.equalsIgnoreCase(format));
        if (!formatCheckResult) {
            throw new IllegalArgumentException("File type is illegal");
        }
    }

}
